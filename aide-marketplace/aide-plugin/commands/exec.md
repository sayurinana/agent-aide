---
description: 任务执行流程。基于 task-spec.md 执行任务，包含流程设计、迭代实现、验证交付、文档更新和收尾。
---

# Aide 任务执行

你正在执行 Aide 任务执行流程。本流程基于任务细则（task-spec.md）完成实际的任务实施。

## 流程概览

```
流程设计 → 迭代实现 → 验证交付 → 文档更新 → 收尾
```

## 运行特点

- **完整闭环**：包含状态记录、git 提交、流程校验
- **可追溯**：每个步骤都有记录，支持中断恢复
- **自动化**：状态管理和版本控制通过 aide 程序处理

## 前置条件

确认存在 `task-spec.md`：
- 存在：读取并理解任务细则
- 不存在：提示用户先执行 `/aide:prep` 或提供任务细则

---

## 环节 1：流程设计

### 1.1 启动任务

执行命令开始新任务：
```bash
aide flow start flow-design "开始任务: <任务简述>"
```

### 1.2 理解任务细则

仔细阅读 `task-spec.md`：
- 明确任务目标和成功标准
- 理解执行步骤和依赖关系
- 识别技术决策和约束

### 1.3 分析项目环境

根据任务需要：
- 阅读相关代码文件
- 了解项目结构和约定
- 识别需要修改的模块

### 1.4 制定执行计划

产出执行计划，包含：
- 具体的实现步骤
- 每个步骤的预期产出
- 步骤间的依赖关系
- 潜在风险和应对方案

> 复杂任务建议使用 sequential-thinking 进行结构化规划

### 1.5 完成流程设计

记录步骤推进：
```bash
aide flow next-step "流程设计完成，计划 N 个实现步骤"
```

---

## 环节 2：迭代实现

### 2.1 进入实现环节

```bash
aide flow next-part impl "开始迭代实现"
```

### 2.2 按计划执行

对于每个实现步骤：

1. **执行前**：明确本步骤目标
2. **执行中**：自由发挥，完成实际编码/修改
3. **执行后**：记录完成
   ```bash
   aide flow next-step "<本步骤完成的内容简述>"
   ```

### 2.3 处理问题

遇到问题时：

**一般问题（可继续）**：
```bash
aide flow issue "<问题描述>"
```
记录后继续执行，后续解决。

**严重错误（阻塞）**：
```bash
aide flow error "<错误描述>"
```
必须先解决再继续。处理方式：
1. 尝试自行解决（最多3次）
2. 成功：在 `discuss/` 创建分析文档记录解决过程
3. 失败：停止并告知用户

### 2.4 需要回退时

发现设计问题需要回退：
```bash
aide flow back-part flow-design "发现 xxx 问题，需要调整设计"
```

步骤内小回退：
```bash
aide flow back-step "<回退原因>"
```

---

## 环节 3：验证交付

### 3.1 进入验证环节

```bash
aide flow next-part verify "开始验证交付"
```

### 3.2 对照任务细则验证

逐项检查 `task-spec.md` 中的成功标准：
- 每个标准是否满足
- 每个交付物是否完成
- 功能是否正常工作

### 3.3 执行测试

根据项目情况：
- 运行已有测试套件
- 手动测试关键功能
- 验证边界情况

### 3.4 记录验证结果

```bash
aide flow next-step "验证完成: <验证结论>"
```

验证失败时：
- 记录失败原因
- 回退到实现环节修复
- 修复后重新验证

---

## 环节 4：文档更新

### 4.1 进入文档环节

```bash
aide flow next-part docs "开始文档更新"
```

### 4.2 更新相关文档

根据任务影响更新：
- `README.md`（如有用户可见变更）
- `CHANGELOG.md`（记录本次变更）
- 其他相关文档

### 4.3 CHANGELOG 更新规范

在 `CHANGELOG.md` 中：
1. 在 `[Unreleased]` 区块添加本次变更
2. 使用语义化分类（Added/Changed/Fixed/Removed）
3. 简明描述变更内容

### 4.4 记录完成

```bash
aide flow next-step "文档更新完成"
```

---

## 环节 5：收尾

### 5.1 进入收尾环节

```bash
aide flow next-part finish "开始收尾"
```

### 5.2 清理工作

- 删除临时文件和调试代码
- 确保代码格式规范
- 检查是否有遗漏的 TODO

### 5.3 最终检查

确认：
- 所有计划步骤已完成
- 所有测试通过
- 文档已更新
- 仓库状态干净

### 5.4 完成任务

```bash
aide flow next-step "任务完成"
```

### 5.5 向用户汇报

总结本次任务：
- 完成了什么
- 主要变更点
- 遗留问题（如有）
- 后续建议（如有）

---

## 错误恢复机制

### ⚠ 警告级别

- 记录问题：`aide flow issue "<描述>"`
- 分析是否影响继续
- 可继续：记录"继续-xxx"
- 需解决：记录"待解决-xxx"

### ✗ 错误级别

- 记录错误：`aide flow error "<描述>"`
- 必须解决后才能继续
- 尝试自行解决（最多3次）
- 成功：在 `discuss/` 创建分析文档
- 失败：停止并告知用户

---

## 注意事项

1. **状态同步**：每个步骤变化都要通过 `aide flow` 记录
2. **原子提交**：aide flow 会自动处理 git add 和 commit
3. **业务自由**：编写业务代码时自由发挥，不受格式约束
4. **简体中文**：所有输出和记录使用简体中文
5. **可恢复**：任务中断后可通过状态记录恢复进度
