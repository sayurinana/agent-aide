@startuml subplan6-task-analysis
!theme plain
title 子计划 6: 任务分析阶段增强

start

partition "1. 复杂度评估指导原则" {
    :整理评估维度;
    note right
        结构维度: 模块数、文件数、依赖关系
        逻辑维度: 业务复杂度、状态管理
        集成维度: 外部依赖、数据格式
        风险维度: 技术风险、影响范围
    end note

    :定义复杂度等级;
    note right
        简单: 直接执行
        中等: 直接执行，注意顺序
        复杂: 必须拆分子计划
        超大: 拆分为独立任务
    end note

    :制定拆分标准;
    note right
        1. 涉及 3+ 独立模块
        2. 自然分为多个阶段
        3. 存在高风险环节
        4. 明确的前后依赖
        5. 需要多次对话
    end note
}

partition "2. 设计子计划结构" {
    :设计任务导览格式;
    note right
        # 任务导览
        ## 任务概述
        ## 子计划列表
        | 序号 | 名称 | 状态 | 依赖 |
        ## 当前进度
    end note

    :设计子计划细则格式;
    note right
        # 子计划 N: 名称
        ## 目标
        ## 成功标准
        ## 执行步骤
        ## 交付物
    end note
}

partition "3. 实现拆分逻辑" {
    :修改 /aide:run 的 task-optimize;

    :任务分析;
    :复杂度评估;

    if (复杂度 >= 复杂?) then (是)
        :识别可独立交付阶段;
        :按依赖关系排序;
        :生成任务导览文档;
        :生成各子计划细则;
    else (否)
        :生成单一任务细则;
    endif
}

partition "4. 实现循环执行机制" {
    :修改 /aide:run 执行逻辑;

    :读取任务导览;
    :确定当前子计划;

    while (还有未完成的子计划?) is (是)
        :执行 flow-design;
        :执行 impl;
        :执行 verify;
        :执行 docs;
        :标记子计划完成;
        :更新任务导览;
    endwhile (否)

    :执行 finish;
}

partition "5. 更新 /aide:run command" {
    :整合上述逻辑;
    :更新命令文档;
}

partition "6. 更新设计文档" {
    :创建复杂度评估指南;
    :更新 run command 文档;
}

stop
@enduml
