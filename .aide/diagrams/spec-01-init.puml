@startuml spec-01-init
!theme plain
title 子计划1: aide init 修改 - 程序逻辑流图

|handle_init|
start
:接收命令行参数;

note right
  **修改点1**:
  不再调用 find_project_root()
  直接使用 Path.cwd()
end note

:root = Path.cwd();
:cfg = ConfigManager(root);
:cfg.ensure_config();
:cfg.ensure_gitignore();
:输出成功消息;
stop

|ConfigManager.ensure_gitignore|
start
:加载配置文件;
:读取 general.gitignore_aide;

if (gitignore_aide 配置存在?) then (是)
    :使用配置值;
else (否)
    note right
      **修改点2**:
      默认值改为 False
    end note
    :默认值 = False;
endif

if (gitignore_aide == True?) then (是)
    :检查 .gitignore 是否存在;
    if (.gitignore 存在?) then (是)
        if (已包含 .aide/?) then (是)
            :无操作;
        else (否)
            :追加 .aide/ 到 .gitignore;
        endif
    else (否)
        :创建 .gitignore 并写入 .aide/;
    endif
else (否)
    :不添加忽略项;
endif
stop

legend right
  **涉及文件**:
  - aide-program/aide/main.py
    - handle_init() 函数
  - aide-program/aide/core/config.py
    - DEFAULT_CONFIG 常量 (第107行)
    - ensure_gitignore() 方法 (第334行)
endlegend

@enduml
