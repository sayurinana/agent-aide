@startuml task-flow
title 任务执行流程图：改进 aide flow 的 git 工作流

start
:阅读任务细则;
note right: task-spec.md

partition "代码修改" {
  :修改 branch.py;
  note right
    - 重构 _merge_normal()
    - 添加清理函数
    - 修改提交信息格式
  end note

  :修改 tracker.py;
  note right
    调整 finish 触发逻辑
    （如需要）
  end note
}

partition "测试验证" {
  :创建测试任务;
  :执行完整 flow 流程;
  :检查最终 git 历史;

  if (只有 2 个提交?) then (是)
    :检查文件清理结果;
    if (清理正确?) then (是)
      :验证通过;
    else (否)
      :修复清理逻辑;
      -> 执行完整 flow 流程;
    endif
  else (否)
    :修复合并逻辑;
    -> 执行完整 flow 流程;
  endif
}

:更新文档;
stop

@enduml
