@startuml subplan4-docs-system
!theme plain
title 子计划 4: 项目文档体系设计与实现

start

partition "1. 设计文档结构规范" {
    :设计总导览文档格式;
    note right
        # 项目导览
        ## 项目简介
        ## 架构概述
        ## 区块索引
        - [区块A](./blocks/a.md)
        - [区块B](./blocks/b.md)
    end note

    :设计子区块文档格式;
    note right
        # 区块名称
        ## 概述
        ## 文件清单
        ## 核心组件
        ## 接口说明
        ## 依赖关系
    end note

    :制定区块划分规则;
    note right
        1. 按目录结构自然划分
        2. 按功能模块语义划分
        3. 单个区块不超过 5000 行
        4. 保持区块间低耦合
    end note
}

partition "2. 设计文档创建流程" {
    :目录探索;
    note right
        遍历目录结构
        统计文件数量和大小
        识别 .gitignore 排除项
    end note

    :初步区块划分;
    note right
        根据目录结构和文件类型
        生成初步区块计划
    end note

    :区块验证;
    note right
        浅层探索各区块
        验证划分合理性
        调整区块边界
    end note

    :逐区块深度了解;
    note right
        每个区块完整阅读
        提取核心信息
        生成文档
    end note

    :进度检查点;
    note right
        记录进度到区块计划文档
        支持多对话续接
    end note
}

partition "3. 设计文档更新流程" {
    :分区块验证;
    note right
        对比文档与代码
        识别差异
    end note

    :差异检测;
    note right
        标记需要更新的部分
    end note

    :增量更新;
    note right
        只更新有变化的区块
        更新导览索引
    end note
}

partition "4. 创建 /aide:docs command" {
    :创建 commands/docs.md;
    :定义命令流程;
    note right
        - 检查文档目录配置
        - 首次创建/更新逻辑
        - 区块进度追踪
        - 多对话续接支持
    end note
    :强制触发 aide skill;
}

partition "5. 更新相关文档" {
    :创建文档规范文档;
    :更新 plugin 设计文档;
}

stop
@enduml
