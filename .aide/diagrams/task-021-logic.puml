@startuml
skinparam defaultFontName "Arial"
skinparam dpi 300
scale 0.5

title 程序逻辑流图：任务计划文件清理钩子

start

partition "run_pre_commit_hooks" {
  :接收参数;
  note right
    root, git, status,
    from_phase, to_phase,
    action, config
  end note

  if (to_phase == finish\n且 action == next-part?) then (是)
    :调用清理钩子;
  else (否)
  endif

  if (from_phase == flow-design?) then (是)
    :调用 PlantUML 钩子;
  else (否)
  endif

  if (from_phase == docs?) then (是)
    :调用 CHANGELOG 钩子;
  else (否)
  endif
}

partition "_hook_clean_task_plans" {
  :获取 plans_path 配置;
  note right: 默认 .aide/task-plans

  :构建目录路径;

  if (目录存在?) then (否)
    :返回;
    detach
  else (是)
  endif

  :列出所有文件;

  if (有文件?) then (否)
    :返回;
    detach
  else (是)
  endif

  while (遍历文件) is (有)
    :删除文件;
  endwhile (无)

  :输出清理结果;
}

stop
@enduml
