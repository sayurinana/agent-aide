@startuml
skinparam defaultFontName "PingFang SC"
skinparam dpi 300
scale 0.5

title 程序逻辑流图：finish 提交信息生成

start

partition "_merge_normal() / _merge_with_temp_branch()" {
  :获取 branch_info.task_summary;
  note right
    例如: "开始任务准备: 实现新功能"
  end note

  :调用 _clean_task_summary();
}

partition "_clean_task_summary(task_summary)" {
  :遍历前缀列表;
  note right
    _TASK_SUMMARY_PREFIXES:
    - "开始任务准备: "
    - "开始任务准备:"
    - "开始任务准备： "
    - "开始任务准备："
  end note

  if (task_summary 以某前缀开头?) then (是)
    :移除前缀;
    :返回清理后的字符串;
    note right
      例如: "实现新功能"
    end note
  else (否)
    :返回原字符串;
  endif
}

partition "生成提交信息" {
  :构建 commit_msg;
  note right
    格式: "完成：{分支名} - {clean_summary}"
    例如: "完成：aide/024 - 实现新功能"
  end note

  :执行 git commit;
}

stop
@enduml
