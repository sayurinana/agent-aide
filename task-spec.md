# 任务细则：为 user-docs 添加分步执行和接续执行能力

## 目标

重构 `aide-marketplace/aide-plugin/commands/user-docs.md`，使其具有与 `user-graph.md` 相同的**分步执行**和**接续执行**能力。

## 背景

- `user-graph.md` 已实现：计划文件检查 → 首次分析计划 → 后续接续执行 → 步骤间暂停支持
- `user-docs.md` 当前是简单顺序流程，缺乏进度追踪和接续能力

## 具体步骤

### 步骤 1：重构文档结构

将 `user-docs.md` 的结构调整为：

1. **前置准备**（保留原有）
2. **开始**
   - 检查计划文件
   - 根据计划文件状态决定流程
3. **分析和计划阶段**（新增，首次运行）
4. **接续执行阶段**（新增，后续运行）
5. **步骤执行流程**（重构原有生成流程）
6. **文档内容规范**（保留原有）
7. **配置项**（更新）
8. **注意事项**（更新）

### 步骤 2：设计计划文档结构

参考 `user-graph.md` 的 `plan.md`，设计 user-docs 的计划文档：

```markdown
# 用户文档生成计划

## 项目概述
## 项目类型
## 文档结构
## 执行步骤（表格形式，含状态）
## 当前进度
## 备注
```

### 步骤 3：实现分析和计划阶段

当计划文件不存在时：
1. 检查前置条件（README 规范、项目文档）
2. 分析项目（读取项目信息、确定类型）
3. 规划文档结构
4. 生成计划文档
5. 用户确认

### 步骤 4：实现接续执行阶段

当计划文件存在时：
1. 读取计划文档
2. 显示当前进度
3. 确认继续（继续/查看详情/重新开始）

### 步骤 5：实现步骤执行流程

将文档生成拆分为独立步骤：
1. 创建目录结构
2. 生成各个文档文件（每个文件一个步骤）
3. 更新 README 链接

每个步骤：
- 显示当前任务
- 执行生成
- 更新计划文档
- 步骤间询问（继续/查看产出/暂停）

### 步骤 6：添加配置项

添加新配置项：`user_docs.docs_plan_path`
- 默认值：`docs/user-docs-plan.md`
- 说明：用户文档生成计划文件路径

## 验证标准

1. 首次运行时正确进入分析和计划阶段，生成计划文档
2. 后续运行时正确读取计划文档，显示进度并支持接续
3. 步骤执行时支持暂停保存进度
4. 计划文档正确记录执行状态和进度
5. 保持与 user-graph.md 的风格一致性

## 参考文件

- `aide-marketplace/aide-plugin/commands/user-graph.md`（分步执行模式参考）
- `aide-marketplace/aide-plugin/commands/user-docs.md`（待重构文件）
