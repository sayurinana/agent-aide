# AI-AGENT_preparation.md

## 使用说明

1. 工作前先阅读本文件与同目录的模板文件，确保理解整体流程。
2. 所有记录与沟通统一使用简体中文。
3. 复杂或多模块任务建议调用Sequential-Thinking，输出分析结论后再进入优化。
4. 临时约定统一记录在`optimized-task.md`的"执行前约束"表格，确认后标记状态。

## 全程通用

### 核心必做

1. 全程按照"任务分析 → 任务内容优化 → 待定项处理 → 优化结果生成"顺序执行。
2. 关键决策、风险与假设同步写入`optimized-task.md`。
3. 优先使用本地工具；调用任何MCP前需确认权限。

### 补充细则

1. 遇到模糊需求时主动询问，不做假设。
2. 遇到阻塞或需求变化，及时回退到相应阶段并向用户说明原因。

### MCP 调用基准表

| 服务 | 典型场景 | 最低记录要求 |
| --- | --- | --- |
| mcp-sequential-thinking | 需求包含多子目标、存在多方案对比时 | 在optimized-task.md注明调用与结论摘要 |
| mcp-desktop-commander | 运行终端命令、读写文件、搜索内容 | 说明命令目的、关键输出或影响 |
| mcp-context7 | 查询外部官方文档或API说明 | 标注查询库ID、主题与主要引用 |
| mcp-web-search | 调研最新资讯或缺失文档时 | 说明关键词、来源筛选与可信度 |

## 1. 任务分析阶段

### 核心必做

1. **全面分析now-task.md内容**
   - 理解任务的核心目标和具体要求
   - 识别任务的复杂度和涉及范围
   - 分析任务与项目现有结构的关系

2. **项目环境分析**
   - 根据任务复杂度审阅相关内容
   - 分析项目结构、现有规范、相关文档
   - 研究类似任务的处理方式和经验

3. **复杂度评估**
   - 判断是否需要使用Sequential-Thinking进行结构化分析
   - 识别任务中的多层含义、多个子目标或复杂业务逻辑

## 2. 任务内容优化阶段

### 核心必做

1. **准确性优化**
   - 检查任务描述的准确性和完整性
   - 识别歧义和不明确之处
   - 明确任务边界和成功标准

2. **简洁性优化**
   - 识别和处理冗余表述
   - 区分真实冗余与必要的重复强调
   - 确保表达简洁但不失准确性

3. **可执行性优化**
   - 将抽象要求转化为具体可执行的步骤
   - 确保每个步骤都有明确的输入、输出和验证标准
   - 考虑执行顺序和依赖关系
   - 按`undetermined-template.md`列出所有优化或替代方案，写入`undetermined.md`并标注优势/风险

## 3. 待定项处理机制

### 核心必做

1. **记录待定项**：参考`undetermined-template.md`格式，将待定项写入`undetermined.md`
2. **统一确认**：完整分析后统一向用户确认所有待定项
3. **结果整理**：用户确认后删除不采纳的待定项，多方案待定项仅保留采纳方案
4. **方案唯一性**：确保每个保留待定项只有唯一实施方案

### 补充细则

1. 在未获得用户统一确认前，禁止进入下一阶段或修改`optimized-task.md`
2. 用户不配合删除待定项时再次澄清确认

## 4. 优化结果生成

### 核心必做

1. **生成optimized-task.md**
   - 包含优化后的完整任务描述
   - 明确的执行步骤和验证标准
   - 整合用户确认的待定项结果

2. **质量验证**
   - 确保优化后的任务描述清晰、准确、可执行
   - 验证任务目标与原始需求的一致性
   - 确认所有关键决策点都已明确

3. **用户最终确认**
   - 向用户展示optimized-task.md
   - 若用户满意，重命名为`task-spec.md`，A过程结束
   - 若用户不满意，根据用户意见返工到分析优化阶段

## 返工机制

- 若用户对`undetermined.md`有异议：根据意见调整待定项，重新生成`undetermined.md`
- 若用户对`optimized-task.md`不满意：根据用户提出的具体意见，返工到分析优化阶段，重新产出中间文档

## 最终产出

A过程的最终产出物是`task-spec.md`（由`optimized-task.md`重命名而来），作为B部分的输入依赖。
